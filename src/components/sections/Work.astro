---
import Section from './Section.astro';

interface Project {
	title: string;
	description: string;
	link: string;
	tags: string[];
	logo?: { src: string; alt?: string };
}

interface Props {
	projects: Project[];
	intro?: string;
}
const { projects, intro } = Astro.props;

type DescSegment = { type: 'text'; content: string } | { type: 'link'; text: string; href: string };

function parseDescription(description: string): DescSegment[] {
	const segments: DescSegment[] = [];
	const re = /\[([^\]]+)\]\(([^)]+)\)/g;
	let lastIndex = 0;
	let match;
	while ((match = re.exec(description)) !== null) {
		if (match.index > lastIndex) {
			segments.push({ type: 'text', content: description.slice(lastIndex, match.index) });
		}
		segments.push({ type: 'link', text: match[1], href: match[2] });
		lastIndex = re.lastIndex;
	}
	if (lastIndex < description.length) {
		segments.push({ type: 'text', content: description.slice(lastIndex) });
	}
	return segments.length > 0 ? segments : [{ type: 'text', content: description }];
}
---

<Section id="work" title="Work">
	{intro && <p class="section-intro">{intro}</p>}
	<ul class="project-list">
		{projects.map((project) => (
			<li class="project-card">
				<div class="project-title-row">
					{project.logo && (
						<div class="project-logo-wrap">
							<img src={project.logo.src} alt={project.logo.alt ?? project.title} class="project-logo" width={40} height={40} />
						</div>
					)}
					<h3 class="project-title">
						<a href={project.link}>{project.title}</a>
					</h3>
				</div>
				<p class="project-desc">
							{parseDescription(project.description).map((seg) =>
								seg.type === 'link' ? (
									<a href={seg.href} target="_blank" rel="noopener noreferrer" class="project-desc-link">{seg.text}</a>
								) : (
									seg.content
								)
							)}
				</p>
				<ul class="project-tags">
					{project.tags.map((tag) => <li>{tag}</li>)}
				</ul>
			</li>
		))}
	</ul>
</Section>

<style>
	.section-intro {
		margin-bottom: 1.25rem !important;
	}

	.project-list {
		list-style: none;
		margin: 0;
		padding: 0;
		display: grid;
		gap: 1.25rem;
	}

	.project-card {
		padding: 1.25rem;
		background: rgba(255, 255, 255, 0.7);
		border: 1px solid rgba(0, 0, 0, 0.08);
		border-radius: 12px;
		transition: border-color 0.2s, box-shadow 0.2s;
	}

	.project-title-row {
		display: flex;
		align-items: center;
		gap: 0.75rem;
		margin-bottom: 0.5rem;
	}

	.project-logo-wrap {
		width: 40px;
		height: 40px;
		flex-shrink: 0;
		display: flex;
		align-items: center;
		justify-content: center;
		background: rgba(255, 255, 255, 0.9);
		border-radius: 8px;
		border: 1px solid rgba(0, 0, 0, 0.06);
		overflow: hidden;
	}

	.project-logo {
		width: 28px;
		height: 28px;
		object-fit: contain;
	}

	.project-card:hover {
		border-color: rgba(13, 115, 119, 0.3);
		box-shadow: 0 4px 12px rgba(0, 0, 0, 0.04);
	}

	.project-title {
		font-size: 1.0625rem;
		font-weight: 600;
		margin: 0;
	}

	.project-title a {
		color: #1a1a1a;
		text-decoration: none;
	}

	.project-title a:hover {
		color: #0d7377;
	}

	.project-desc {
		font-size: 0.9375rem;
		line-height: 1.6;
		color: #555;
		margin: 0 0 0.75rem;
	}

	.project-desc-link {
		color: #0d7377;
		text-decoration: none;
	}

	.project-desc-link:hover {
		text-decoration: underline;
	}

	.project-tags {
		display: flex;
		flex-wrap: wrap;
		gap: 0.5rem;
		list-style: none;
		margin: 0;
		padding: 0;
		font-size: 0.8125rem;
		font-weight: 500;
		color: #0d7377;
	}
</style>
